# Copyright 2024 Canonical Ltd.
# See LICENSE file for licensing details.
name: test-async-flask
summary: A flask async worker test app
description: OCI image for the async worker test flask app
version: "0.1"
base: ubuntu@22.04
license: Apache-2.0
platforms:
  amd64:

extensions:
  - flask-framework

parts:
  flask-framework/async-dependencies:
    plugin: python
    source: .

services:
  celery-worker:
    override: replace
    command: celery -A app:celery_app worker -c 2 --loglevel DEBUG
    startup: enabled
    user: _daemon_
    working-dir: /flask/app
  celery-beat-scheduler:
    override: replace
    command: celery -A app:celery_app beat --loglevel DEBUG -s /tmp/celerybeat-schedule
    startup: enabled
    user: _daemon_
    working-dir: /flask/app
